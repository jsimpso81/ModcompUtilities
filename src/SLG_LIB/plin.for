C-----PLIN.FOR
      SUBROUTINE PLIN
      DIMENSION MDOTS(7),IPAD(7),IPX(44),IPY(44)
      LOGICAL YPLUS,XMAJ,MA
      COMMON /IOUNIT/LU1,LU2,LU3,LU4,LU5
      COMMON /PLTCOM/
     &NPLOT,MINX,MAXX,NDX,NDY,LTYPE,LWDTH,DEGRAD,
     &NBITS,NBTM1,NBYTE,NBYM1,NCHAR,NCHM1,MSK(7),IBT(16),
     &LDX,LDY,IXT,IYT,NDLTX,NDLTY,MOVY,NCLOCX,
     &LMSK(16),ICH,ICW,IVS,IHS,
     &ISCAN,NSCAN,NWORD,IM(30720)
C*****NOTE: INTEGER*2 IM(NWORD) IS TRUE DIMENSION
C           (AS SPECIFIED IN BLOCK COMMON AND MAIN)
      DATA MDOTS/+1,-2,+3,-4,+5,-6,+7/,IPAD/1,5,12,21,26,37,44/
      DATA IPX/0,-1, 1, 1,-1,-1, 0, 2, 1, 0, 0,-1, 0,-1,-1,-1,
     &         0, 0, 1, 1, 1, 1, 1, 0, 0,-1,-1,-1,-1,-1,-1, 0,
     &         0, 1, 1, 1, 1, 1, 1, 1, 0, 0,-1,-1/
      DATA IPY/0, 0, 1,-1,-1, 0, 2, 0, 0,-1,-1, 0,-1, 0, 0, 1,
     &         1, 1, 1, 0, 0, 0,-1,-1,-1,-1,-1, 0, 0, 1, 1, 1,
     &         1, 1, 1, 0, 0, 0,-1,-1,-1,-1,-1,-1/
C-----INSURE NON-X DIRECTION OF LINE SEGMENT
D     WRITE(LU2,*) 'NDX,LDX,NDY,LDY',NDX,LDX,NDY,LDY
      IF (NDX.LE.LDX) GO TO 40
      IX1=LDX
      IY1=LDY
      IX2=NDX
      IY2=NDY
      LNTYP=LTYPE
      GO TO 80
   40 IX1=NDX
      IY1=NDY
      IX2=LDX
      IY2=LDY
      LNTYP=-LTYPE
   80 MD=0
      MDY=IY2-IY1
      IF (MDY.EQ.0) LNTYP=0
      YPLUS=MDY.GE.0
      MAJ=IX2-IX1-IABS(MDY)
      XMAJ=MAJ.GE.0
C-----DOES LINE CROSS THE BAND?
  100 IF (IX2.LT.0.OR.IX1.GE.NSCAN) GO TO 800
C-----YES, LINE SEGMENT CROSSES
      IXT=IX1
      IYT=IY1
      NDLTX=IX2-IX1
      NDLY=IY2-IY1
      NDLTY=IABS(NDLY)
      MOVY=0
      IF (NDLY.EQ.0) GO TO 300
      MOVY=ISIGN(1,NDLY)
      IF (LNTYP.EQ.0.OR.NDLTX.EQ.0) GO TO 300
C-----USE ELLIPTICAL CURVE
  250 CALL PCRV(LNTYP)
      GO TO 800
C-----STRAIGHT LINE
C-----RESET DDA
  300 NDW=0
      NRUN=MAX0(NDLTX,NDLTY)
      ISUM=NRUN/2
      MA=NDLTX.GE.NDLTY
      GO TO 400
C-----CHECK COORDINATES VS. BAND LIMITS
  400 IF (IXT.GE.0) GO TO 500
  410 NRUN=NRUN-1
      IF (MA) GO TO 450
C-----MAJOR Y MOVES
      IYT=IYT+MOVY
      ISUM=ISUM-NDLTX
      IF (ISUM.GE.0) GO TO 410
      ISUM=ISUM+NDLTY
      GO TO 470
C-----MAJOR X MOVES
  450 ISUM=ISUM-NDLTY
      IF (ISUM.GE.0) GO TO 470
      ISUM=ISUM+NDLTX
      IYT=IYT+MOVY
      GO TO 470
  470 IXT=IXT+1
      GO TO 400
  500 NDW=IXT*ISCAN+IYT/NBITS+1
      NDB=NBITS-MOD(IYT,NBITS)
      IYT=MOVY
  550 IXT=NBITS-MOD(NRUN,NBITS)
D     WRITE(LU2,*) 'SET BIT IN WORD',NDB,NDW
      IM(NDW)=IOR(IM(NDW),IAND(IBT(NDB),LMSK(IXT)))
      IF (NRUN.LE.0) GO TO 800
C-----COMPUTE MOVES CROSSING BAND
      NRUN=NRUN-1
      IF (MA) GO TO 580
C-----MAJOR Y-MOVES
      ISUM=ISUM-NDLTX
      IF (ISUM.GE.0) GO TO 610
      ISUM=ISUM+NDLTY
      GO TO 600
C-----MAJOR X-MOVES
  580 ISUM=ISUM-NDLTY
      IF (ISUM.GE.0) GO TO 590
      IYT=MOVY
      ISUM=ISUM+NDLTX
      GO TO 600
  590 IYT=0
      GO TO 600
C-----INDEX FOR +X-MOVES
  600 NDW=NDW+ISCAN
      IF (NDW.GT.NWORD) GO TO 800
C-----INDEX FOR Y-MOVES
  610 IF (IYT) 620,690,640
C-----INDEX FOR -Y-MOVES
  620 NDB=NDB+1
      IF (NDB.LE.NBITS) GO TO 690
      NDW=NDW-1
      NDB=1
      IF (NDW.LE.0) GO TO 800
      GO TO 690
C-----INDEX FOR +Y-MOVES
  640 NDB=NDB-1
      IF (NDB.GT.0) GO TO 690
      NDW=NDW+1
      NDB=NBITS
  690 GO TO 550
C-----IS LINE WIDE ENOUGH YET?
  800 IF (MD.GE.LWDTH) GO TO 900
C-----NO, WIDEN IT
      MD=MD+1
      NDB=MDOTS(MD)
      IF (LNTYP) 850,820,870
C-----MULTI-DOT STRAIGHT LINES
  820 IF (XMAJ) GO TO 840
C-----MAJOR Y-MOVE
      IX1=IX1+NDB
      IX2=IX2+NDB
      GO TO 899
C-----MAJOR +X-MOVE
  840 IY1=IY1+NDB
      IY2=IY2+NDB
      GO TO 899
C-----MULTI DOT CCW CURVE
  850 IF (YPLUS) GO TO 860
C-----(-Y MOVE)
      IX1=IX1+NDB
      IY2=IY2+NDB
      GO TO 899
C-----(+Y MOVE)
  860 IY1=IY1+NDB
      IX2=IX2+NDB
      GO TO 899
C-----MULTI-DOT CW CURVE
  870 IF (YPLUS) GO TO 890
C-----(-Y MOVE)
      IY1=IY1-NDB
      IX2=IX2-NDB
      GO TO 899
C-----(+Y MOVE)
  890 IX1=IX1+NDB
      IY2=IY2-NDB
      GO TO 899
C-----GO BACK AND PLOT A WIDENING LINE
  899 GO TO 100
C-----MULTI-DOT LINE PADDING (SIMULATE ROUND-TIPPED PEN POINT)
  900 IF (LWDTH.LE.0) GO TO 999
      IX1=LDX
      IY1=LDY
      IX2=NDX
      IY2=NDY
      NDB=IPAD(LWDTH)
      DO 920 NDW=1,NDB
      IX1=IX1+IPX(NDW)
      IY1=IY1+IPY(NDW)
      CALL PDOT(IX1,IY1,-1)
      IX2=IX2+IPX(NDW)
      IY2=IY2+IPY(NDW)
      CALL PDOT(IX2,IY2,-1)
920   CONTINUE                                                          ENDDO
  999 RETURN
      END
